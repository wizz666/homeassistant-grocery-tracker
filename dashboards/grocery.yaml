title: Matlagret
# ğŸ’¡ KÃ¶k-platta / tablet-tips:
#    BokmÃ¤rk URL:en med ?kiosk i slutet fÃ¶r att dÃ¶lja sidebar och header:
#    https://<din-ha-url>/grocery-dashboard/skanna?kiosk
#    kiosk-mode-kortet Ã¤r installerat och hanterar detta automatiskt.

views:

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TAB 1: SKANNA â€” GrÃ¶n identitet  ğŸŸ¢
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: Skanna
    path: skanna
    icon: mdi:barcode-scan
    cards:

      # â”€â”€ Header med shimmer-animation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:button-card
        name: "Matlagret"
        label: Skanna varor Â· Hantera lager Â· Minska svinn
        show_label: true
        show_icon: true
        icon: mdi:fridge-outline
        tap_action:
          action: none
        extra_styles: |
          @keyframes hdr-green {
            0%   { background-position: 0% 50%; }
            50%  { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
          }
        styles:
          card:
            - background: "linear-gradient(-45deg, #1b5e20, #2e7d32, #388e3c, #43a047)"
            - background-size: "300% 300%"
            - animation: "hdr-green 10s ease infinite"
            - border-radius: 20px
            - padding: "20px 24px"
            - box-shadow: "0 8px 32px rgba(27, 94, 32, 0.45)"
          grid:
            - grid-template-areas: '"i n" "i l"'
            - grid-template-rows: "min-content min-content"
            - grid-template-columns: "min-content 1fr"
          icon:
            - color: "rgba(255,255,255,0.95)"
            - width: 40px
          name:
            - font-size: 22px
            - font-weight: 800
            - color: white
            - text-align: left
            - letter-spacing: "0.3px"
          label:
            - font-size: 12px
            - color: "rgba(255,255,255,0.70)"
            - text-align: left
            - margin-top: 4px

      # â”€â”€ Statrad â€” 2Ã—2 stor glassmorphism big-number grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # AnvÃ¤nder custom_fields + JS-template (entity.state) â€” fungerar med alla button-card-versioner
      - type: grid
        columns: 2
        square: false
        cards:

          # Totalt i lager
          - type: custom:button-card
            entity: sensor.grocery_total_items
            show_name: false
            show_icon: false
            show_state: false
            tap_action:
              action: none
            custom_fields:
              body: |
                [[[
                  const v = entity ? entity.state : 'â€“';
                  return `<div style="text-align:center;padding:14px 8px 12px;">
                    <div style="font-size:11px;color:rgba(46,125,50,0.60);margin-bottom:4px;">ğŸ“¦</div>
                    <div style="font-size:36px;font-weight:900;color:#2e7d32;line-height:1;">${v}</div>
                    <div style="font-size:9px;letter-spacing:1.8px;text-transform:uppercase;color:rgba(46,125,50,0.60);margin-top:7px;">VAROR I LAGER</div>
                  </div>`;
                ]]]
            styles:
              card:
                - background: "rgba(46,125,50,0.10)"
                - border: "1px solid rgba(46,125,50,0.30)"
                - border-radius: "20px"
                - padding: "0"
                - box-shadow: "0 4px 24px rgba(46,125,50,0.12)"
              custom_fields:
                body:
                  - width: "100%"

          # Snart utgÃ¥ngna
          - type: custom:button-card
            entity: sensor.grocery_expiring_soon
            show_name: false
            show_icon: false
            show_state: false
            tap_action:
              action: none
            extra_styles: |
              @keyframes glow-warn {
                0%, 100% { box-shadow: 0 4px 20px rgba(255,152,0,0.20); }
                50%      { box-shadow: 0 4px 36px rgba(255,152,0,0.70); }
              }
            custom_fields:
              body: |
                [[[
                  const v = entity ? entity.state : 'â€“';
                  return `<div style="text-align:center;padding:14px 8px 12px;">
                    <div style="font-size:11px;color:#ff9800;margin-bottom:4px;">â°</div>
                    <div style="font-size:36px;font-weight:900;color:#ff9800;line-height:1;">${v}</div>
                    <div style="font-size:9px;letter-spacing:1.8px;text-transform:uppercase;color:rgba(255,152,0,0.60);margin-top:7px;">SNART UTGÃ…NGNA</div>
                  </div>`;
                ]]]
            styles:
              card:
                - background: "rgba(255,152,0,0.10)"
                - border: "1px solid rgba(255,152,0,0.30)"
                - border-radius: "20px"
                - padding: "0"
                - "{% if states('sensor.grocery_expiring_soon') | int(0) > 0 %}animation: glow-warn 2.5s ease-in-out infinite{% else %}box-shadow: 0 4px 20px rgba(0,0,0,0.12){% endif %}"
              custom_fields:
                body:
                  - width: "100%"

          # UtgÃ¥ngna
          - type: custom:button-card
            entity: sensor.grocery_expired
            show_name: false
            show_icon: false
            show_state: false
            tap_action:
              action: none
            extra_styles: |
              @keyframes glow-danger {
                0%, 100% { box-shadow: 0 4px 20px rgba(244,67,54,0.20); }
                50%      { box-shadow: 0 4px 36px rgba(244,67,54,0.70); }
              }
            custom_fields:
              body: |
                [[[
                  const v = entity ? entity.state : 'â€“';
                  return `<div style="text-align:center;padding:14px 8px 12px;">
                    <div style="font-size:11px;color:#f44336;margin-bottom:4px;">âš ï¸</div>
                    <div style="font-size:36px;font-weight:900;color:#f44336;line-height:1;">${v}</div>
                    <div style="font-size:9px;letter-spacing:1.8px;text-transform:uppercase;color:rgba(244,67,54,0.60);margin-top:7px;">UTGÃ…NGNA</div>
                  </div>`;
                ]]]
            styles:
              card:
                - background: "rgba(244,67,54,0.10)"
                - border: "1px solid rgba(244,67,54,0.30)"
                - border-radius: "20px"
                - padding: "0"
                - "{% if states('sensor.grocery_expired') | int(0) > 0 %}animation: glow-danger 1.8s ease-in-out infinite{% else %}box-shadow: 0 4px 20px rgba(0,0,0,0.12){% endif %}"
              custom_fields:
                body:
                  - width: "100%"

          # LÃ¥gt lager
          - type: custom:button-card
            entity: sensor.grocery_low_stock
            show_name: false
            show_icon: false
            show_state: false
            tap_action:
              action: none
            extra_styles: |
              @keyframes glow-low {
                0%, 100% { box-shadow: 0 4px 20px rgba(255,87,34,0.20); }
                50%      { box-shadow: 0 4px 32px rgba(255,87,34,0.65); }
              }
            custom_fields:
              body: |
                [[[
                  const v = entity ? entity.state : 'â€“';
                  return `<div style="text-align:center;padding:14px 8px 12px;">
                    <div style="font-size:11px;color:#ff5722;margin-bottom:4px;">ğŸ“‰</div>
                    <div style="font-size:36px;font-weight:900;color:#ff5722;line-height:1;">${v}</div>
                    <div style="font-size:9px;letter-spacing:1.8px;text-transform:uppercase;color:rgba(255,87,34,0.60);margin-top:7px;">LÃ…GT LAGER</div>
                  </div>`;
                ]]]
            styles:
              card:
                - background: "rgba(255,87,34,0.08)"
                - border: "1px solid rgba(255,87,34,0.25)"
                - border-radius: "20px"
                - padding: "0"
                - "{% if states('sensor.grocery_low_stock') | int(0) > 0 %}animation: glow-low 2s ease-in-out infinite{% else %}box-shadow: 0 4px 20px rgba(0,0,0,0.12){% endif %}"
              custom_fields:
                body:
                  - width: "100%"

      # â”€â”€ Lager per plats â€” progress-bar kort (JS-template) â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: horizontal-stack
        cards:

          # KYL â€” tema-sÃ¤kra fÃ¤rger (var(--primary-text-color) fungerar pÃ¥ light och dark)
          - type: custom:button-card
            entity: sensor.grocery_location_kyl
            show_name: false
            show_icon: false
            show_state: false
            tap_action:
              action: none
            custom_fields:
              inner: |
                [[[
                  const n = parseInt(entity && entity.state) || 0;
                  const te = states['sensor.grocery_total_items'];
                  const total = parseInt(te && te.state) || 1;
                  const pct = Math.min(Math.round(n / total * 100), 100);
                  return `<div style="text-align:center;padding:14px 8px 12px;">
                    <div style="font-size:32px;font-weight:900;color:#1565c0;line-height:1;">${n}</div>
                    <div style="font-size:11px;margin:5px 0 4px;letter-spacing:0.5px;color:var(--primary-text-color);">ğŸ§Š Kyl</div>
                    <div style="height:4px;background:rgba(21,101,192,0.15);border-radius:3px;overflow:hidden;margin:6px 4px 4px;">
                      <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,#1565c0,#42a5f5);border-radius:3px;"></div>
                    </div>
                    <div style="font-size:9px;color:var(--secondary-text-color);letter-spacing:0.5px;">${pct}%</div>
                  </div>`;
                ]]]
            styles:
              card:
                - background: "rgba(21,101,192,0.08)"
                - border: "2px solid rgba(21,101,192,0.30)"
                - border-radius: "18px"
                - padding: "0"
                - overflow: "hidden"
              custom_fields:
                inner:
                  - width: "100%"

          # FRYS
          - type: custom:button-card
            entity: sensor.grocery_location_frys
            show_name: false
            show_icon: false
            show_state: false
            tap_action:
              action: none
            custom_fields:
              inner: |
                [[[
                  const n = parseInt(entity && entity.state) || 0;
                  const te = states['sensor.grocery_total_items'];
                  const total = parseInt(te && te.state) || 1;
                  const pct = Math.min(Math.round(n / total * 100), 100);
                  return `<div style="text-align:center;padding:14px 8px 12px;">
                    <div style="font-size:32px;font-weight:900;color:#00838f;line-height:1;">${n}</div>
                    <div style="font-size:11px;margin:5px 0 4px;letter-spacing:0.5px;color:var(--primary-text-color);">â„ï¸ Frys</div>
                    <div style="height:4px;background:rgba(0,131,143,0.15);border-radius:3px;overflow:hidden;margin:6px 4px 4px;">
                      <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,#00838f,#4dd0e1);border-radius:3px;"></div>
                    </div>
                    <div style="font-size:9px;color:var(--secondary-text-color);letter-spacing:0.5px;">${pct}%</div>
                  </div>`;
                ]]]
            styles:
              card:
                - background: "rgba(0,131,143,0.08)"
                - border: "2px solid rgba(0,131,143,0.30)"
                - border-radius: "18px"
                - padding: "0"
                - overflow: "hidden"
              custom_fields:
                inner:
                  - width: "100%"

          # SKAFFERI
          - type: custom:button-card
            entity: sensor.grocery_location_skafferi
            show_name: false
            show_icon: false
            show_state: false
            tap_action:
              action: none
            custom_fields:
              inner: |
                [[[
                  const n = parseInt(entity && entity.state) || 0;
                  const te = states['sensor.grocery_total_items'];
                  const total = parseInt(te && te.state) || 1;
                  const pct = Math.min(Math.round(n / total * 100), 100);
                  return `<div style="text-align:center;padding:14px 8px 12px;">
                    <div style="font-size:32px;font-weight:900;color:#e65100;line-height:1;">${n}</div>
                    <div style="font-size:11px;margin:5px 0 4px;letter-spacing:0.5px;color:var(--primary-text-color);">ğŸ  Skafferi</div>
                    <div style="height:4px;background:rgba(230,81,0,0.15);border-radius:3px;overflow:hidden;margin:6px 4px 4px;">
                      <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,#e65100,#ffca28);border-radius:3px;"></div>
                    </div>
                    <div style="font-size:9px;color:var(--secondary-text-color);letter-spacing:0.5px;">${pct}%</div>
                  </div>`;
                ]]]
            styles:
              card:
                - background: "rgba(230,81,0,0.08)"
                - border: "2px solid rgba(230,81,0,0.30)"
                - border-radius: "18px"
                - padding: "0"
                - overflow: "hidden"
              custom_fields:
                inner:
                  - width: "100%"

      # â”€â”€ Scanner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:grocery-scanner-card
        title: Matscanner
        ios_shortcut_add: "LÃ¤gg till vara"
        ios_shortcut_remove: "Ta bort vara"


  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TAB 2: INKÃ–PSLISTA â€” BlÃ¥ identitet  ğŸ”µ
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: InkÃ¶pslista
    path: inkopslista
    icon: mdi:cart
    cards:

      # â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:button-card
        name: "InkÃ¶pslista"
        label: Bocka av varor Â· Tryck "Klar" nÃ¤r du Ã¤r fÃ¤rdig i butiken
        show_label: true
        show_icon: true
        icon: mdi:cart-outline
        tap_action:
          action: none
        extra_styles: |
          @keyframes hdr-blue {
            0%   { background-position: 0% 50%; }
            50%  { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
          }
        styles:
          card:
            - background: "linear-gradient(-45deg, #0d47a1, #1565c0, #1976d2, #1e88e5)"
            - background-size: "300% 300%"
            - animation: "hdr-blue 10s ease infinite"
            - border-radius: 20px
            - padding: "20px 24px"
            - box-shadow: "0 8px 32px rgba(13, 71, 161, 0.45)"
          grid:
            - grid-template-areas: '"i n" "i l"'
            - grid-template-rows: "min-content min-content"
            - grid-template-columns: "min-content 1fr"
          icon:
            - color: "rgba(255,255,255,0.95)"
            - width: 40px
          name:
            - font-size: 22px
            - font-weight: 800
            - color: white
            - text-align: left
          label:
            - font-size: 12px
            - color: "rgba(255,255,255,0.70)"
            - text-align: left
            - margin-top: 4px

      # â”€â”€ InkÃ¶pslista â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: todo-list
        entity: todo.shopping_list
        hide_completed: false
        card_mod:
          style: |
            ha-card {
              border-radius: 18px !important;
              overflow: hidden;
              border: 1px solid rgba(255,255,255,0.08);
            }

      # â”€â”€ Grupperade Ã¥tgÃ¤rdsknappar (inga gap â€” ser ut som en enhet) â”€
      - type: custom:vertical-stack-in-card
        card_mod:
          style: |
            ha-card {
              border-radius: 18px !important;
              overflow: hidden;
              border: 1px solid rgba(255,255,255,0.08);
            }
        cards:
          - type: custom:button-card
            name: "âœ…  Jag Ã¤r klar â€” ta bort inhandlade varor"
            show_icon: false
            tap_action:
              action: call-service
              service: script.grocery_clear_shopping_list_btn
            styles:
              card:
                - background: "linear-gradient(135deg, #1b5e20, #43a047)"
                - border-radius: 0
                - padding: "18px 20px"
                - box-shadow: none
                - margin: 0
              name:
                - font-size: 15px
                - font-weight: 700
                - color: white
          - type: custom:button-card
            name: "ğŸ“¤  Skicka lista till telefon"
            show_icon: false
            tap_action:
              action: call-service
              service: script.grocery_push_shopping_list_btn
            styles:
              card:
                - background: "linear-gradient(135deg, #0d47a1, #1976d2)"
                - border-radius: 0
                - padding: "16px 20px"
                - border-top: "1px solid rgba(255,255,255,0.12)"
                - box-shadow: none
                - margin: 0
              name:
                - font-size: 14px
                - font-weight: 600
                - color: white
          - type: custom:button-card
            name: "âœ¨  FÃ¶reslÃ¥ varor att handla"
            show_icon: false
            tap_action:
              action: call-service
              service: script.grocery_generate_shopping_list_btn
            styles:
              card:
                - background: "linear-gradient(135deg, #00695c, #00897b)"
                - border-radius: 0
                - padding: "16px 20px"
                - border-top: "1px solid rgba(255,255,255,0.12)"
                - box-shadow: none
                - margin: 0
              name:
                - font-size: 14px
                - font-weight: 600
                - color: white


  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TAB 3: RECEPTFÃ–RSLAG â€” Orange/RÃ¶d identitet  ğŸŸ 
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: ReceptfÃ¶rslag
    path: recept
    icon: mdi:chef-hat
    cards:

      # â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:button-card
        name: "ReceptfÃ¶rslag"
        label: AI-recept baserade pÃ¥ vad som snart gÃ¥r ut
        show_label: true
        show_icon: true
        icon: mdi:chef-hat
        tap_action:
          action: none
        extra_styles: |
          @keyframes hdr-orange {
            0%   { background-position: 0% 50%; }
            50%  { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
          }
        styles:
          card:
            - background: "linear-gradient(-45deg, #bf360c, #d84315, #e64a19, #f4511e)"
            - background-size: "300% 300%"
            - animation: "hdr-orange 10s ease infinite"
            - border-radius: 20px
            - padding: "20px 24px"
            - box-shadow: "0 8px 32px rgba(191, 54, 12, 0.45)"
          grid:
            - grid-template-areas: '"i n" "i l"'
            - grid-template-rows: "min-content min-content"
            - grid-template-columns: "min-content 1fr"
          icon:
            - color: "rgba(255,255,255,0.95)"
            - width: 40px
          name:
            - font-size: 22px
            - font-weight: 800
            - color: white
            - text-align: left
          label:
            - font-size: 12px
            - color: "rgba(255,255,255,0.70)"
            - text-align: left
            - margin-top: 4px

      # â”€â”€ Aktiv leverantÃ¶r + senast uppdaterad â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:mushroom-template-card
        primary: >
          {% set p = states('input_select.grocery_recipe_provider') %}
          {% if p == 'groq' %}ğŸŸ  Groq â€“ Llama 3.3 70B
          {% elif p == 'gemini' %}ğŸ”µ Gemini 2.0 Flash
          {% elif p == 'openrouter' %}ğŸŸ£ OpenRouter â€“ Mistral
          {% elif p == 'mistral' %}ğŸ©· Mistral Small
          {% elif p == 'openai' %}ğŸŸ¢ GPT-4o Mini
          {% elif p == 'anthropic' %}ğŸŸ¡ Claude Haiku
          {% elif p == 'ha_ai_task' %}ğŸ©µ HA AI Task
          {% else %}Ingen AI vald â€” klicka fÃ¶r att vÃ¤lja{% endif %}
        secondary: "ğŸ• {{ states('sensor.grocery_last_recipe') }}"
        icon: mdi:robot-outline
        icon_color: >
          {% set p = states('input_select.grocery_recipe_provider') %}
          {% if p == 'disabled' %}disabled
          {% elif p in ['groq','openrouter'] %}deep-orange
          {% elif p in ['gemini','openai'] %}blue
          {% elif p == 'anthropic' %}amber
          {% elif p == 'mistral' %}pink
          {% else %}teal{% endif %}
        tap_action:
          action: navigate
          navigation_path: /grocery-dashboard/installningar
        card_mod:
          style: |
            ha-card { border-radius: 14px; }

      # â”€â”€ Receptkort â€” glassmorphism â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: markdown
        card_mod:
          style: |
            ha-card {
              border-radius: 20px;
              background: rgba(191,54,12,0.08);
              border: 1px solid rgba(230,74,25,0.25);
              box-shadow: 0 6px 28px rgba(191,54,12,0.16);
              overflow: hidden;
            }
        content: |
          {% set recipe = state_attr('sensor.grocery_last_recipe', 'recipe') %}
          {% set updated = states('sensor.grocery_last_recipe') %}
          {% set ingredients = state_attr('sensor.grocery_last_recipe', 'ingredients') %}
          {% set kwh = state_attr('sensor.grocery_last_recipe', 'cooking_kwh') %}
          {% set cost = state_attr('sensor.grocery_last_recipe', 'cooking_cost_kr') %}
          {% set appliance = state_attr('sensor.grocery_last_recipe', 'cooking_appliance') %}
          {% set minutes = state_attr('sensor.grocery_last_recipe', 'cooking_minutes') %}
          {% set price = state_attr('sensor.grocery_last_recipe', 'electricity_price') %}
          {% if recipe %}
          _ğŸ“… {{ updated }}_&nbsp;&nbsp;&nbsp;_ğŸ¥• {{ ingredients }}_

          ---

          {{ recipe }}

          ---

          {% if kwh and kwh | float(0) > 0 %}
          {% set a_emoji = {'spis': 'ğŸ³', 'ugn': 'ğŸ”¥', 'mikro': 'ğŸ“¡'} %}
          {% set emoji = a_emoji[appliance] if appliance in a_emoji else 'âš¡' %}
          {{ emoji }} **{{ appliance | capitalize }}** Â· {{ minutes }} min Â· {{ kwh }} kWh Â· ca **{{ cost }} kr** _({{ price }} kr/kWh)_
          {% endif %}
          {% set actual_kwh = states('input_number.grocery_actual_cooking_kwh') | float(0) %}
          {% set actual_cost = states('input_number.grocery_actual_cooking_cost') | float(0) %}
          {% if actual_kwh > 0 %}
          ğŸ“Š **Faktisk fÃ¶rbrukning** (Tibber Pulse): {{ actual_kwh }} kWh Â· **{{ actual_cost }} kr**
          _Inkluderar all fÃ¶rbrukning i hemmet under matlagningen_
          {% endif %}
          {% else %}
          ### ğŸ‘¨â€ğŸ³ Inga receptfÃ¶rslag Ã¤nnu

          VÃ¤lj en AI-leverantÃ¶r nedan och klicka pÃ¥ en knapp.
          Recepten baseras pÃ¥ ingredienser som snart gÃ¥r ut â€” det Ã¤r sÃ¥ vi minskar matsvinnet!
          {% endif %}

      # â”€â”€ Matlagningssession â€“ Starta â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: conditional
        conditions:
          - condition: state
            entity: input_boolean.grocery_cooking_active
            state: "off"
        card:
          type: custom:button-card
          name: "ğŸ³  Starta matlagningssession"
          label: MÃ¤ter faktisk elfÃ¶rbrukning via Tibber Pulse
          show_label: true
          show_icon: false
          tap_action:
            action: call-service
            service: script.grocery_start_cooking_btn
          styles:
            card:
              - background: "linear-gradient(135deg, #e64a19, #bf360c)"
              - border-radius: 14px
              - padding: "18px 20px"
              - box-shadow: "0 3px 14px rgba(191,54,12,0.38)"
            name:
              - font-size: 15px
              - font-weight: 700
              - color: white
            label:
              - font-size: 11px
              - color: "rgba(255,255,255,0.75)"
              - margin-top: 4px

      # â”€â”€ Matlagningssession â€“ PÃ¥gÃ¥r â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: conditional
        conditions:
          - condition: state
            entity: input_boolean.grocery_cooking_active
            state: "on"
        card:
          type: custom:vertical-stack-in-card
          card_mod:
            style: |
              ha-card {
                border-radius: 16px !important;
                overflow: hidden;
                border: 1px solid rgba(230,74,25,0.35);
              }
          cards:
            - type: custom:mushroom-template-card
              primary: "Matlagning pÃ¥gÃ¥r..."
              secondary: "âš¡ {{ states('sensor.tibber_pulse_dammtorpsgatan_22_power') | int(0) }} W just nu"
              icon: mdi:pot-steam
              icon_color: deep-orange
              tap_action:
                action: none
              card_mod:
                style: |
                  @keyframes pulse-cooking {
                    0%, 100% { box-shadow: 0 0 0 0 rgba(230, 74, 25, 0); }
                    50%      { box-shadow: 0 0 0 9px rgba(230, 74, 25, 0.38); }
                  }
                  ha-card {
                    border-radius: 0 !important;
                    border-left: 4px solid #e64a19;
                    animation: pulse-cooking 2s ease-in-out infinite;
                  }
            - type: custom:button-card
              name: "âœ…  Klar â€” berÃ¤kna faktisk fÃ¶rbrukning"
              show_icon: false
              tap_action:
                action: call-service
                service: script.grocery_stop_cooking_btn
              styles:
                card:
                  - background: "linear-gradient(135deg, #b71c1c, #c62828)"
                  - border-radius: 0
                  - padding: "16px 20px"
                  - box-shadow: none
                  - margin: 0
                name:
                  - font-size: 14px
                  - font-weight: 700
                  - color: white

      # â”€â”€ GRATIS-sektion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:button-card
        name: "ğŸŸ¢  GRATIS â€” ingen kreditkort"
        show_icon: false
        tap_action:
          action: none
        styles:
          card:
            - background: "rgba(67, 160, 71, 0.10)"
            - border-left: "3px solid #43a047"
            - border-radius: 10px
            - box-shadow: none
            - padding: "8px 14px"
          name:
            - font-size: 11px
            - font-weight: 800
            - letter-spacing: "1.2px"
            - color: "#43a047"
            - text-align: left

      # Groq (full-width)
      - type: custom:button-card
        name: Groq
        label: "Llama 3.3 70B Â· gratis, ingen kreditkort"
        show_label: true
        show_icon: false
        tap_action:
          action: call-service
          service: pyscript.grocery_suggest_recipes
          service_data:
            provider_override: groq
        extra_styles: |
          @keyframes glow-groq {
            0%, 100% { box-shadow: 0 4px 16px rgba(249,115,22,0.45); }
            50%      { box-shadow: 0 6px 32px rgba(249,115,22,0.80); }
          }
        styles:
          card:
            - background: "linear-gradient(135deg, #f97316, #c2410c)"
            - border-radius: 16px
            - padding: "18px 16px"
            - "{% if states('input_select.grocery_recipe_provider') == 'groq' %}animation: glow-groq 2.5s ease-in-out infinite{% else %}box-shadow: 0 3px 14px rgba(249,115,22,0.40){% endif %}"
          name:
            - font-size: 16px
            - font-weight: 800
            - color: white
          label:
            - font-size: 11px
            - color: "rgba(255,255,255,0.80)"
            - margin-top: 4px

      # OpenRouter + Mistral
      - type: horizontal-stack
        cards:
          - type: custom:button-card
            name: OpenRouter
            label: Mistral 24B
            show_label: true
            show_icon: false
            tap_action:
              action: call-service
              service: pyscript.grocery_suggest_recipes
              service_data:
                provider_override: openrouter
            extra_styles: |
              @keyframes glow-openrouter {
                0%, 100% { box-shadow: 0 4px 16px rgba(124,58,237,0.45); }
                50%      { box-shadow: 0 6px 32px rgba(124,58,237,0.80); }
              }
            styles:
              card:
                - background: "linear-gradient(135deg, #7c3aed, #5b21b6)"
                - border-radius: 16px
                - padding: "18px 8px"
                - "{% if states('input_select.grocery_recipe_provider') == 'openrouter' %}animation: glow-openrouter 2.5s ease-in-out infinite{% else %}box-shadow: 0 3px 14px rgba(124,58,237,0.40){% endif %}"
              name:
                - font-size: 16px
                - font-weight: 800
                - color: white
              label:
                - font-size: 11px
                - color: "rgba(255,255,255,0.80)"
                - margin-top: 4px
          - type: custom:button-card
            name: Mistral
            label: Small
            show_label: true
            show_icon: false
            tap_action:
              action: call-service
              service: pyscript.grocery_suggest_recipes
              service_data:
                provider_override: mistral
            extra_styles: |
              @keyframes glow-mistral {
                0%, 100% { box-shadow: 0 4px 16px rgba(219,39,119,0.45); }
                50%      { box-shadow: 0 6px 32px rgba(219,39,119,0.80); }
              }
            styles:
              card:
                - background: "linear-gradient(135deg, #db2777, #9d174d)"
                - border-radius: 16px
                - padding: "18px 8px"
                - "{% if states('input_select.grocery_recipe_provider') == 'mistral' %}animation: glow-mistral 2.5s ease-in-out infinite{% else %}box-shadow: 0 3px 14px rgba(219,39,119,0.40){% endif %}"
              name:
                - font-size: 16px
                - font-weight: 800
                - color: white
              label:
                - font-size: 11px
                - color: "rgba(255,255,255,0.80)"
                - margin-top: 4px

      # HA AI Task (full width)
      - type: custom:button-card
        name: HA AI Task
        label: Inbyggt i HA Â· Ingen API-nyckel behÃ¶vs
        show_label: true
        show_icon: false
        tap_action:
          action: call-service
          service: pyscript.grocery_suggest_recipes
          service_data:
            provider_override: ha_ai_task
        extra_styles: |
          @keyframes glow-ha {
            0%, 100% { box-shadow: 0 4px 16px rgba(0,151,167,0.45); }
            50%      { box-shadow: 0 6px 32px rgba(0,151,167,0.80); }
          }
        styles:
          card:
            - background: "linear-gradient(135deg, #0097a7, #006064)"
            - border-radius: 16px
            - padding: "18px 16px"
            - "{% if states('input_select.grocery_recipe_provider') == 'ha_ai_task' %}animation: glow-ha 2.5s ease-in-out infinite{% else %}box-shadow: 0 3px 14px rgba(0,151,167,0.40){% endif %}"
          name:
            - font-size: 16px
            - font-weight: 800
            - color: white
          label:
            - font-size: 11px
            - color: "rgba(255,255,255,0.80)"
            - margin-top: 4px

      # â”€â”€ BETALT-sektion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:button-card
        name: "ğŸ’³  BETALT â€” krÃ¤ver separat API-konto"
        show_icon: false
        tap_action:
          action: none
        styles:
          card:
            - background: "rgba(217, 119, 6, 0.10)"
            - border-left: "3px solid #d97706"
            - border-radius: 10px
            - box-shadow: none
            - padding: "8px 14px"
          name:
            - font-size: 11px
            - font-weight: 800
            - letter-spacing: "1.2px"
            - color: "#d97706"
            - text-align: left

      # OpenAI + Anthropic
      - type: horizontal-stack
        cards:
          - type: custom:button-card
            name: OpenAI
            label: GPT-4o Mini
            show_label: true
            show_icon: false
            tap_action:
              action: call-service
              service: pyscript.grocery_suggest_recipes
              service_data:
                provider_override: openai
            extra_styles: |
              @keyframes glow-openai {
                0%, 100% { box-shadow: 0 4px 16px rgba(5,150,105,0.45); }
                50%      { box-shadow: 0 6px 32px rgba(5,150,105,0.80); }
              }
            styles:
              card:
                - background: "linear-gradient(135deg, #059669, #065f46)"
                - border-radius: 16px
                - padding: "18px 8px"
                - "{% if states('input_select.grocery_recipe_provider') == 'openai' %}animation: glow-openai 2.5s ease-in-out infinite{% else %}box-shadow: 0 3px 14px rgba(5,150,105,0.40){% endif %}"
              name:
                - font-size: 16px
                - font-weight: 800
                - color: white
              label:
                - font-size: 11px
                - color: "rgba(255,255,255,0.80)"
                - margin-top: 4px
          - type: custom:button-card
            name: Anthropic
            label: Claude Haiku
            show_label: true
            show_icon: false
            tap_action:
              action: call-service
              service: pyscript.grocery_suggest_recipes
              service_data:
                provider_override: anthropic
            extra_styles: |
              @keyframes glow-anthropic {
                0%, 100% { box-shadow: 0 4px 16px rgba(217,119,6,0.45); }
                50%      { box-shadow: 0 6px 32px rgba(217,119,6,0.80); }
              }
            styles:
              card:
                - background: "linear-gradient(135deg, #d97706, #92400e)"
                - border-radius: 16px
                - padding: "18px 8px"
                - "{% if states('input_select.grocery_recipe_provider') == 'anthropic' %}animation: glow-anthropic 2.5s ease-in-out infinite{% else %}box-shadow: 0 3px 14px rgba(217,119,6,0.40){% endif %}"
              name:
                - font-size: 16px
                - font-weight: 800
                - color: white
              label:
                - font-size: 11px
                - color: "rgba(255,255,255,0.80)"
                - margin-top: 4px

      # â”€â”€ HÃ¤mta via instÃ¤lld leverantÃ¶r â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:button-card
        name: "ğŸ”„  HÃ¤mta via instÃ¤lld leverantÃ¶r"
        label: AnvÃ¤nder leverantÃ¶ren du valt i InstÃ¤llningar-fliken
        show_label: true
        show_icon: false
        tap_action:
          action: call-service
          service: script.grocery_suggest_recipes_btn
        styles:
          card:
            - background: "linear-gradient(135deg, #37474f, #263238)"
            - border-radius: 14px
            - padding: "16px 20px"
            - box-shadow: "0 2px 10px rgba(0,0,0,0.28)"
          name:
            - font-size: 14px
            - font-weight: 700
            - color: white
          label:
            - font-size: 11px
            - color: "rgba(255,255,255,.65)"
            - margin-top: 3px


  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TAB 4: INSTÃ„LLNINGAR â€” Lila identitet  ğŸŸ£
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: InstÃ¤llningar
    path: installningar
    icon: mdi:cog
    cards:

      # â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:button-card
        name: "InstÃ¤llningar"
        label: AI-leverantÃ¶r och API-nycklar fÃ¶r receptfÃ¶rslag
        show_label: true
        show_icon: true
        icon: mdi:robot-happy-outline
        tap_action:
          action: none
        extra_styles: |
          @keyframes hdr-purple {
            0%   { background-position: 0% 50%; }
            50%  { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
          }
        styles:
          card:
            - background: "linear-gradient(-45deg, #4a148c, #6a1b9a, #7b1fa2, #8e24aa)"
            - background-size: "300% 300%"
            - animation: "hdr-purple 10s ease infinite"
            - border-radius: 20px
            - padding: "20px 24px"
            - box-shadow: "0 8px 32px rgba(74, 20, 140, 0.45)"
          grid:
            - grid-template-areas: '"i n" "i l"'
            - grid-template-rows: "min-content min-content"
            - grid-template-columns: "min-content 1fr"
          icon:
            - color: "rgba(255,255,255,0.95)"
            - width: 40px
          name:
            - font-size: 22px
            - font-weight: 800
            - color: white
            - text-align: left
          label:
            - font-size: 12px
            - color: "rgba(255,255,255,0.70)"
            - text-align: left
            - margin-top: 4px

      - type: custom:mushroom-select-card
        entity: input_select.grocery_recipe_provider
        name: AI-leverantÃ¶r fÃ¶r receptfÃ¶rslag
        icon: mdi:robot-outline

      # â”€â”€ Nyckel-fÃ¤lt per leverantÃ¶r â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: groq
        card:
          type: entities
          title: "ğŸŸ¢ Groq â€“ gratis, ingen kreditkort"
          entities:
            - entity: input_text.grocery_api_key_groq
              name: API-nyckel
          card_mod:
            style: |
              ha-card { border-radius: 14px; border-left: 4px solid #f97316; }

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: openrouter
        card:
          type: entities
          title: "ğŸŸ¢ OpenRouter â€“ gratis-tier, 25+ modeller"
          entities:
            - entity: input_text.grocery_api_key_openrouter
              name: API-nyckel
          card_mod:
            style: |
              ha-card { border-radius: 14px; border-left: 4px solid #7c3aed; }

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: mistral
        card:
          type: entities
          title: "ğŸŸ¢ Mistral â€“ gratis-tier"
          entities:
            - entity: input_text.grocery_api_key_mistral
              name: API-nyckel
          card_mod:
            style: |
              ha-card { border-radius: 14px; border-left: 4px solid #db2777; }

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: openai
        card:
          type: entities
          title: "ğŸ’³ OpenAI â€“ betalt (GPT-4o Mini)"
          entities:
            - entity: input_text.grocery_api_key_openai
              name: API-nyckel
          card_mod:
            style: |
              ha-card { border-radius: 14px; border-left: 4px solid #059669; }

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: anthropic
        card:
          type: entities
          title: "ğŸ’³ Anthropic â€“ betalt (Claude Haiku)"
          entities:
            - entity: input_text.grocery_api_key_anthropic
              name: API-nyckel
          card_mod:
            style: |
              ha-card { border-radius: 14px; border-left: 4px solid #d97706; }

      # â”€â”€ Testknapp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state_not: disabled
        card:
          type: custom:button-card
          name: "ğŸ‘¨â€ğŸ³  Testa receptfÃ¶rslag nu"
          show_icon: false
          tap_action:
            action: call-service
            service: script.grocery_suggest_recipes_btn
          styles:
            card:
              - background: "linear-gradient(135deg, #bf360c, #e64a19)"
              - border-radius: 14px
              - padding: "16px"
              - box-shadow: "0 2px 12px rgba(191,54,12,0.35)"
            name:
              - font-size: 15px
              - font-weight: 700
              - color: white

      # â”€â”€ Instruktioner per leverantÃ¶r â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: groq
        card:
          type: markdown
          content: |
            **Groq** â€” Llama 3.3 70B, helt gratis, ingen kreditkort
            1. GÃ¥ till [console.groq.com](https://console.groq.com)
            2. Skapa ett konto
            3. Klicka **API Keys â†’ Create API Key**
            4. Klistra in nyckeln i fÃ¤ltet ovan
          card_mod:
            style: |
              ha-card { border-radius: 14px; }

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: openrouter
        card:
          type: markdown
          content: |
            **OpenRouter** â€” 25+ gratis AI-modeller, logga in med GitHub/Google
            1. GÃ¥ till [openrouter.ai/keys](https://openrouter.ai/keys)
            2. Logga in med Google eller GitHub
            3. Klicka **Create Key**
            4. Klistra in nyckeln i fÃ¤ltet ovan

            _Modell: `mistralai/mistral-small-3.1-24b-instruct:free` â€” automatisk fallback vid rate-limit_
          card_mod:
            style: |
              ha-card { border-radius: 14px; }

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: mistral
        card:
          type: markdown
          content: |
            **Mistral AI** â€” Mistral Small, gratis-tier (krÃ¤ver telefonnummer, ej kreditkort)
            1. GÃ¥ till [console.mistral.ai](https://console.mistral.ai)
            2. Skapa ett konto
            3. Klicka **API Keys â†’ Create new key**
            4. Klistra in nyckeln i fÃ¤ltet ovan
          card_mod:
            style: |
              ha-card { border-radius: 14px; }

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: openai
        card:
          type: markdown
          content: |
            **OpenAI** â€” GPT-4o Mini (~$0.003/receptfÃ¶rslag)

            > âš ï¸ **ChatGPT Plus â‰  API-Ã¥tkomst** â€” Plus ger tillgÃ¥ng till chat.openai.com, inte API:et.

            1. GÃ¥ till [platform.openai.com](https://platform.openai.com) _(separat konto)_
            2. LÃ¤gg till betalningsmetod
            3. **API Keys â†’ Create new secret key**
            4. Klistra in nyckeln i fÃ¤ltet ovan
          card_mod:
            style: |
              ha-card { border-radius: 14px; }

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: anthropic
        card:
          type: markdown
          content: |
            **Anthropic Claude** â€” Claude Haiku, bÃ¤st kvalitet

            > âš ï¸ **Claude.ai Pro â‰  API-Ã¥tkomst** â€” Pro ger tillgÃ¥ng till claude.ai, inte API:et.

            1. GÃ¥ till [console.anthropic.com](https://console.anthropic.com) _(separat konto)_
            2. LÃ¤gg till betalningsmetod
            3. **API Keys â†’ Create Key**
            4. Klistra in nyckeln i fÃ¤ltet ovan
          card_mod:
            style: |
              ha-card { border-radius: 14px; }

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: ha_ai_task
        card:
          type: markdown
          content: |
            **HA AI Task** â€” Ingen API-nyckel behÃ¶vs hÃ¤r
            KrÃ¤ver att du har en AI-integration konfigurerad i HA:
            **InstÃ¤llningar â†’ Enheter & tjÃ¤nster â†’ LÃ¤gg till integration**
            SÃ¶k efter t.ex. **Google Generative AI** eller **OpenRouter**
          card_mod:
            style: |
              ha-card { border-radius: 14px; border-left: 4px solid #0097a7; }

      # â”€â”€ Ã–versikt nÃ¤r inaktiverat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: disabled
        card:
          type: markdown
          content: |
            ### VÃ¤lj en AI-leverantÃ¶r ovan fÃ¶r att aktivera receptfÃ¶rslag

            #### ğŸŸ¢ Gratis â€” ingen kreditkort krÃ¤vs
            | LeverantÃ¶r | Modell | Nyckel frÃ¥n |
            |---|---|---|
            | **groq** | Llama 3.3 70B | [console.groq.com](https://console.groq.com) |
            | **openrouter** | Mistral 24B (fri) | [openrouter.ai/keys](https://openrouter.ai/keys) |
            | **mistral** | Mistral Small | [console.mistral.ai](https://console.mistral.ai) |
            | **ha_ai_task** | Valfri HA-AI | Ingen nyckel â€” krÃ¤ver AI-integration i HA |

            #### ğŸ’³ Betalt _(krÃ¤ver separat API-konto â€” ej samma som Plus/Pro-prenumeration)_
            | LeverantÃ¶r | Modell | Nyckel frÃ¥n |
            |---|---|---|
            | **openai** | GPT-4o Mini | [platform.openai.com](https://platform.openai.com) |
            | **anthropic** | Claude Haiku | [console.anthropic.com](https://console.anthropic.com) |
          card_mod:
            style: |
              ha-card { border-radius: 14px; }

      # â”€â”€ Matlagningseffekt â€“ sektion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:button-card
        name: "âš¡  Matlagningseffekt (fÃ¶r energiestimering)"
        show_icon: false
        tap_action:
          action: none
        styles:
          card:
            - background: "rgba(230, 74, 25, 0.10)"
            - border-left: "3px solid #e64a19"
            - border-radius: 10px
            - box-shadow: none
            - padding: "8px 14px"
          name:
            - font-size: 11px
            - font-weight: 800
            - letter-spacing: "1.2px"
            - color: "#e64a19"
            - text-align: left

      - type: entities
        title: EffektinstÃ¤llningar (W)
        entities:
          - entity: input_number.grocery_power_spis
            name: "ğŸ³ Spis"
          - entity: input_number.grocery_power_ugn
            name: "ğŸ”¥ Ugn"
          - entity: input_number.grocery_power_mikro
            name: "ğŸ“¡ MikrovÃ¥gsugn"
        card_mod:
          style: |
            ha-card { border-radius: 14px; }

      - type: markdown
        content: |
          Dessa vÃ¤rden anvÃ¤nds fÃ¶r att **uppskatta energikostnad** nÃ¤r AI ger ett receptfÃ¶rslag.
          Ã„r din spis starkare eller svagare? Justera hÃ¤r â€” det pÃ¥verkar kostnadsberÃ¤kningen.

          Vid **Tibber Pulse-session** (Start/Stopp i receptfliken) mÃ¤ts faktisk fÃ¶rbrukning direkt â€” dÃ¥ spelar dessa vÃ¤rden ingen roll.
        card_mod:
          style: |
            ha-card { border-radius: 14px; }


  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TAB 5: SVINNDAGBOK â€” Teal identitet  ğŸ©µ
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: Svinndagbok
    path: svinndagbok
    icon: mdi:recycle
    cards:

      # â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:button-card
        name: "Svinndagbok"
        label: Historik Ã¶ver slÃ¤ngda varor Â· Minska matsvinn
        show_label: true
        show_icon: true
        icon: mdi:leaf-circle-outline
        tap_action:
          action: none
        extra_styles: |
          @keyframes hdr-teal {
            0%   { background-position: 0% 50%; }
            50%  { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
          }
        styles:
          card:
            - background: "linear-gradient(-45deg, #004d40, #00695c, #00796b, #00897b)"
            - background-size: "300% 300%"
            - animation: "hdr-teal 10s ease infinite"
            - border-radius: 20px
            - padding: "20px 24px"
            - box-shadow: "0 8px 32px rgba(0, 77, 64, 0.45)"
          grid:
            - grid-template-areas: '"i n" "i l"'
            - grid-template-rows: "min-content min-content"
            - grid-template-columns: "min-content 1fr"
          icon:
            - color: "rgba(255,255,255,0.95)"
            - width: 40px
          name:
            - font-size: 22px
            - font-weight: 800
            - color: white
            - text-align: left
          label:
            - font-size: 12px
            - color: "rgba(255,255,255,0.70)"
            - text-align: left
            - margin-top: 4px

      # â”€â”€ Totalt svinn â€“ glassmorphism big-number â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:button-card
        entity: sensor.grocery_waste_log
        show_name: false
        show_icon: false
        show_state: false
        tap_action:
          action: none
        custom_fields:
          body: |
            [[[
              const v = entity ? entity.state : 'â€“';
              return `<div style="text-align:center;padding:14px 16px 12px;">
                <div style="font-size:11px;color:rgba(0,105,92,0.60);margin-bottom:4px;">ğŸ—‘ï¸</div>
                <div style="font-size:36px;font-weight:900;color:#00695c;line-height:1;">${v}</div>
                <div style="font-size:9px;letter-spacing:1.8px;text-transform:uppercase;color:rgba(0,105,92,0.60);margin-top:7px;">VAROR REGISTRERADE TOTALT</div>
              </div>`;
            ]]]
        styles:
          card:
            - background: "rgba(0,121,107,0.10)"
            - border: "1px solid rgba(0,121,107,0.28)"
            - border-radius: "20px"
            - padding: "0"
            - box-shadow: "0 4px 24px rgba(0,77,64,0.18)"
          custom_fields:
            body:
              - width: "100%"

      # â”€â”€ ApexCharts â€” svinnutveckling (kumulativt, 30 dagar) â”€â”€â”€â”€â”€â”€â”€
      - type: custom:apexcharts-card
        header:
          show: true
          title: Svinnutveckling â€” senaste 30 dagarna
          show_states: true
          colorize_states: true
        graph_span: 30d
        apex_config:
          chart:
            toolbar:
              show: false
            zoom:
              enabled: false
          stroke:
            curve: stepline
            width: 2
          fill:
            type: gradient
            gradient:
              shadeIntensity: 1
              opacityFrom: 0.55
              opacityTo: 0.05
              stops:
                - 0
                - 100
          grid:
            borderColor: "rgba(128,128,128,0.12)"
          tooltip:
            theme: dark
        series:
          - entity: sensor.grocery_waste_log
            name: Totalt svinn
            color: "#00796b"
            stroke_width: 2
            fill_raw: last
            show:
              in_header: true
              legend_value: true
        card_mod:
          style: |
            ha-card {
              border-radius: 18px;
              border-left: 4px solid #00796b;
            }

      # â”€â”€ Vanligaste svinnvaror â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: markdown
        title: "ğŸ† Vanligaste svinnvaror"
        content: |
          {% set log = state_attr('sensor.grocery_waste_log', 'log') | default([]) | list %}
          {% if log | length == 0 %}
          _Ingen historik Ã¤nnu â€” bra jobbat!_ ğŸŒ±
          {% else %}
          {% set names = log | map(attribute='name') | unique | list | sort %}
          {% set ns = namespace(rows=[]) %}
          {% for name in names %}
            {% set count = log | selectattr('name','eq', name) | list | count %}
            {% set ns.rows = ns.rows + [{'name': name, 'count': count}] %}
          {% endfor %}
          {% set sorted = ns.rows | sort(attribute='count', reverse=true) %}
          {% for row in sorted[:8] %}
          {% set bar_filled = (row.count * 3) | int %}
          {% set bar = 'â–“' * [bar_filled, 12] | min + 'â–‘' * (12 - [bar_filled, 12] | min) %}
          **{{ row.name }}** `{{ bar }}` {{ row.count }}Ã—
          {% endfor %}
          {% if names | length > 8 %}
          _â€¦ och {{ names | length - 8 }} fler_
          {% endif %}
          {% endif %}
        card_mod:
          style:
            .: |
              ha-card {
                border-radius: 16px;
                background: rgba(0,121,107,0.06);
                border: 1px solid rgba(0,121,107,0.18);
                border-top: 4px solid #00897b;
              }
            "ha-markdown$": |
              strong { color: var(--primary-text-color); }
              code {
                font-size: 0.70em;
                letter-spacing: -1px;
                color: #00897b;
                background: transparent;
                font-family: monospace;
              }
              p { margin: 7px 0; line-height: 1.5; }

      # â”€â”€ Denna mÃ¥naden â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: markdown
        title: "ğŸ“… Denna mÃ¥naden"
        content: |
          {% set log = state_attr('sensor.grocery_waste_log', 'log') | default([]) | list %}
          {% set this_month = now().strftime('%Y-%m') %}
          {% set ns = namespace(monthly=[]) %}
          {% for item in log %}
            {% if item.date[:7] == this_month %}
              {% set ns.monthly = ns.monthly + [item] %}
            {% endif %}
          {% endfor %}
          {% if ns.monthly | length == 0 %}
          _Inget svinn registrerat denna mÃ¥nad. Imponerande!_ ğŸŒ±
          {% else %}
          **{{ ns.monthly | length }} varor** slÃ¤ngda hittills i {{ now().strftime('%B %Y') }}

          {% for item in ns.monthly | reverse %}
          - **{{ item.date[8:] }}/{{ item.date[5:7] }}** â€” {{ item.name }}{% if item.source not in ['mobile', 'manual'] %} _({{ item.source }})_{% endif %}
          {% endfor %}
          {% endif %}
        card_mod:
          style: |
            ha-card {
              border-radius: 16px;
              border-top: 4px solid #00796b;
              border-left: none;
              background: rgba(0, 121, 107, 0.06);
            }

      # â”€â”€ Historik â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: markdown
        title: "ğŸ—“ï¸ Svinnhistorik"
        content: |
          {% set log = state_attr('sensor.grocery_waste_log', 'log') | default([]) | list %}
          {% if log | length == 0 %}
          _Ingen historik Ã¤nnu. BÃ¶rja skanna fÃ¶rpackningar nÃ¤r du slÃ¤nger dem!_
          {% else %}
          {% set ns = namespace(last_month='') %}
          {% for item in log | reverse %}
          {% if loop.index <= 60 %}
          {% set m = item.date[:7] %}
          {% if m != ns.last_month %}
          #### {{ m }}
          {% set ns.last_month = m %}
          {% endif %}
          - **{{ item.date[8:] }}/{{ item.date[5:7] }}** {{ item.name }}
          {% endif %}
          {% endfor %}
          {% if log | length > 60 %}
          _... och {{ log | length - 60 }} Ã¤ldre poster_
          {% endif %}
          {% endif %}
        card_mod:
          style: |
            ha-card {
              border-radius: 16px;
              border-left: 3px dashed rgba(0, 121, 107, 0.45);
            }
