title: Matlagret
views:
  - title: Skanna
    path: skanna
    icon: mdi:barcode-scan
    cards:
      - type: custom:grocery-scanner-card
        title: Matscanner
        ios_shortcut_add: "L√§gg till vara"
        ios_shortcut_remove: "Ta bort vara"

      - type: entities
        title: Lagerstatus
        entities:
          - entity: sensor.grocery_total_items
            name: Varor i lager
          - entity: sensor.grocery_expiring_soon
            name: G√•r ut inom 2 dagar
          - entity: sensor.grocery_expired
            name: Utg√•ngna varor
          - entity: sensor.grocery_low_stock
            name: L√•gt lager

  - title: Ink√∂pslista
    path: inkopslista
    icon: mdi:cart
    cards:
      - type: todo-list
        entity: todo.shopping_list
        title: Ink√∂pslista
        hide_completed: true

      - type: button
        name: Skicka lista till telefon
        icon: mdi:cart-arrow-right
        tap_action:
          action: call-service
          service: script.grocery_push_shopping_list_btn

      - type: button
        name: F√∂resl√• varor fr√•n lager
        icon: mdi:cart-plus
        tap_action:
          action: call-service
          service: script.grocery_generate_shopping_list_btn

      - type: button
        name: Receptf√∂rslag
        icon: mdi:chef-hat
        tap_action:
          action: call-service
          service: script.grocery_suggest_recipes_btn

  - title: Inst√§llningar
    path: installningar
    icon: mdi:cog
    cards:
      - type: entities
        title: "üë®‚Äçüç≥ Receptf√∂rslag"
        entities:
          - entity: input_select.grocery_recipe_provider
            name: Leverant√∂r

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state_not: disabled
          - condition: state
            entity: input_select.grocery_recipe_provider
            state_not: ha_ai_task
        card:
          type: entities
          entities:
            - entity: input_text.grocery_recipe_api_key
              name: API-nyckel

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state_not: disabled
        card:
          type: button
          name: Testa receptf√∂rslag nu
          icon: mdi:chef-hat
          tap_action:
            action: call-service
            service: script.grocery_suggest_recipes_btn

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: disabled
        card:
          type: markdown
          content: |
            ### Kom ig√•ng med receptf√∂rslag
            V√§lj en leverant√∂r ovan f√∂r att aktivera automatiska receptf√∂rslag n√§r varor snart g√•r ut.

            | Leverant√∂r | Kostnad | Hur du skaffar nyckel |
            |---|---|---|
            | **groq** | Gratis | [console.groq.com](https://console.groq.com) ‚Äî skapa konto, ingen kreditkort |
            | **gemini** | Gratis | [aistudio.google.com](https://aistudio.google.com) ‚Äî logga in med Google |
            | **ha_ai_task** | Gratis | Kr√§ver AI-integration i HA (t.ex. Google AI eller OpenRouter) ‚Äî ingen API-nyckel h√§r |
            | **anthropic** | Betalt | [console.anthropic.com](https://console.anthropic.com) |

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: groq
        card:
          type: markdown
          content: |
            **Groq** ‚Äî gratis, ingen kreditkort
            1. G√• till [console.groq.com](https://console.groq.com)
            2. Skapa ett konto
            3. Klicka **API Keys ‚Üí Create API Key**
            4. Klistra in nyckeln i f√§ltet ovan

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: gemini
        card:
          type: markdown
          content: |
            **Google Gemini** ‚Äî gratis med Google-konto
            1. G√• till [aistudio.google.com](https://aistudio.google.com)
            2. Logga in med ditt Google-konto
            3. Klicka **Get API key ‚Üí Create API key**
            4. Klistra in nyckeln i f√§ltet ovan

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: anthropic
        card:
          type: markdown
          content: |
            **Anthropic Claude** ‚Äî betaltj√§nst, b√§st kvalitet
            1. G√• till [console.anthropic.com](https://console.anthropic.com)
            2. Skapa ett konto och l√§gg till betalningsmetod
            3. Klicka **API Keys ‚Üí Create Key**
            4. Klistra in nyckeln i f√§ltet ovan

      - type: conditional
        conditions:
          - condition: state
            entity: input_select.grocery_recipe_provider
            state: ha_ai_task
        card:
          type: markdown
          content: |
            **HA AI Task** ‚Äî ingen API-nyckel beh√∂vs h√§r
            Kr√§ver att du har en AI-integration konfigurerad i HA:
            **Inst√§llningar ‚Üí Enheter & tj√§nster ‚Üí L√§gg till integration**
            S√∂k efter t.ex. **Google Generative AI** eller **OpenRouter**

  - title: Svinndagbok
    path: svinndagbok
    icon: mdi:trash-can-outline
    cards:
      - type: entities
        title: Svinn√∂versikt
        entities:
          - entity: sensor.grocery_waste_log
            name: Totalt registrerade svinn

      - type: markdown
        title: "üìÖ Denna m√•naden"
        content: |
          {% set log = state_attr('sensor.grocery_waste_log', 'log') | default([]) | list %}
          {% set this_month = now().strftime('%Y-%m') %}
          {% set ns = namespace(monthly=[]) %}
          {% for item in log %}
            {% if item.date[:7] == this_month %}
              {% set ns.monthly = ns.monthly + [item] %}
            {% endif %}
          {% endfor %}
          {% if ns.monthly | length == 0 %}
          _Inget svinn registrerat denna m√•nad._
          {% else %}
          **{{ ns.monthly | length }} varor** sl√§ngda hittills i {{ now().strftime('%B %Y') }}

          {% for item in ns.monthly | reverse %}
          - **{{ item.date[8:] }}/{{ item.date[5:7] }}** ‚Äî {{ item.name }}{% if item.source not in ['mobile', 'manual'] %} _({{ item.source }})_{% endif %}
          {% endfor %}
          {% endif %}

      - type: markdown
        title: "üóìÔ∏è Svinnhistorik"
        content: |
          {% set log = state_attr('sensor.grocery_waste_log', 'log') | default([]) | list %}
          {% if log | length == 0 %}
          _Ingen historik √§nnu. B√∂rja skanna f√∂rpackningar n√§r du sl√§nger dem!_
          {% else %}
          {% set ns = namespace(last_month='') %}
          {% for item in log | reverse %}
          {% if loop.index <= 60 %}
          {% set m = item.date[:7] %}
          {% if m != ns.last_month %}
          #### {{ m }}
          {% set ns.last_month = m %}
          {% endif %}
          - **{{ item.date[8:] }}/{{ item.date[5:7] }}** {{ item.name }}
          {% endif %}
          {% endfor %}
          {% if log | length > 60 %}
          _... och {{ log | length - 60 }} √§ldre poster_
          {% endif %}
          {% endif %}
