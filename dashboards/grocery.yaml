title: Matlagret
views:
  - title: Skanna
    path: skanna
    icon: mdi:barcode-scan
    cards:
      - type: custom:grocery-scanner-card
        title: Matscanner
        ios_shortcut_add: "L√§gg till vara"
        ios_shortcut_remove: "Ta bort vara"

      - type: entities
        title: Lagerstatus
        entities:
          - entity: sensor.grocery_total_items
            name: Varor i lager
          - entity: sensor.grocery_expiring_soon
            name: G√•r ut inom 2 dagar
          - entity: sensor.grocery_expired
            name: Utg√•ngna varor
          - entity: sensor.grocery_low_stock
            name: L√•gt lager

  - title: Ink√∂pslista
    path: inkopslista
    icon: mdi:cart
    cards:
      - type: todo-list
        entity: todo.shopping_list
        title: Ink√∂pslista
        hide_completed: true

      - type: button
        name: Skicka lista till telefon
        icon: mdi:cart-arrow-right
        tap_action:
          action: call-service
          service: script.grocery_push_shopping_list_btn

      - type: button
        name: F√∂resl√• varor fr√•n lager
        icon: mdi:cart-plus
        tap_action:
          action: call-service
          service: script.grocery_generate_shopping_list_btn

  - title: Svinndagbok
    path: svinndagbok
    icon: mdi:trash-can-outline
    cards:
      - type: entities
        title: Svinn√∂versikt
        entities:
          - entity: sensor.grocery_waste_log
            name: Totalt registrerade svinn

      - type: markdown
        title: "üìÖ Denna m√•naden"
        content: |
          {% set log = state_attr('sensor.grocery_waste_log', 'log') | default([]) | list %}
          {% set this_month = now().strftime('%Y-%m') %}
          {% set ns = namespace(monthly=[]) %}
          {% for item in log %}
            {% if item.date[:7] == this_month %}
              {% set ns.monthly = ns.monthly + [item] %}
            {% endif %}
          {% endfor %}
          {% if ns.monthly | length == 0 %}
          _Inget svinn registrerat denna m√•nad._
          {% else %}
          **{{ ns.monthly | length }} varor** sl√§ngda hittills i {{ now().strftime('%B %Y') }}

          {% for item in ns.monthly | reverse %}
          - **{{ item.date[8:] }}/{{ item.date[5:7] }}** ‚Äî {{ item.name }}{% if item.source not in ['mobile', 'manual'] %} _({{ item.source }})_{% endif %}
          {% endfor %}
          {% endif %}

      - type: markdown
        title: "üóìÔ∏è Svinnhistorik"
        content: |
          {% set log = state_attr('sensor.grocery_waste_log', 'log') | default([]) | list %}
          {% if log | length == 0 %}
          _Ingen historik √§nnu. B√∂rja skanna f√∂rpackningar n√§r du sl√§nger dem!_
          {% else %}
          {% set ns = namespace(last_month='') %}
          {% for item in log | reverse %}
          {% if loop.index <= 60 %}
          {% set m = item.date[:7] %}
          {% if m != ns.last_month %}
          #### {{ m }}
          {% set ns.last_month = m %}
          {% endif %}
          - **{{ item.date[8:] }}/{{ item.date[5:7] }}** {{ item.name }}
          {% endif %}
          {% endfor %}
          {% if log | length > 60 %}
          _... och {{ log | length - 60 }} √§ldre poster_
          {% endif %}
          {% endif %}
